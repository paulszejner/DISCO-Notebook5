---
title: "High temporal resolution Isotope measurements in Tree rings"
output: html_notebook
---
#####  Isotope Dendrochronology
#####  High temporal resolution Isotope measurements in Tree rings.
#####  COURSE: DISC, LTRR, UNIVERSITY OF ARIZONA. INSTRUCTORS: S. BELMECHERI & P. SZEJNER

# How about this time?

Instructions:

The following code and comments should further your experience of the use and interpretation of tree ring Carbon and Oxygen isotopes measurements in cellulose at high temporal resolution. 

The first part of this exercise relies upon high temporal-intra annual resolution measurements of C and O isotope for one year/growing season (1998) from a tree located in US SW (HEL Site) and is based on concepts reviewed in tree ring formation (Xylogenesis), sampling design and strategy, and seasonal coupling of climate and ecophysiology.   

The Second part of this exercise relies upon seasonal resolution  (earlywood and latewood) measurements of C and O for the XX period from multiple trees located in US SW (X Site).

You will need to download the R project from https://github.com/paulszejner/Notebook-5.git 
then each of you will be able to set your own working directory to proceed with this excersises. once you open the Notebook 5.Rproj  you can open  the Notebook 5.Rmd file to proceed with the activity.



## PART 1: Intra-seasonal sampling strategy and corresponding climate signal
The Year 1998 was sampled at X microns for a total of X think sections and O measurements
```{r}
# Read the high resolution O and C data for 1998.
HEL_98 <- read.csv("Data_Notebook5_part1/high_res_HEL_1998.csv") [,c(2,3,8)]
VPD_HEL <- read.csv("Data_Notebook5_part1/VPD_1998_1999_HEL.csv" )[,c(2,3,4)]
colb1 <- c("#D8B70A","#02401B","#A2A475","#D67236")

```

In this next steps, we will explore the seasonal variations of C and O recorded throughout the 1998 growing season
First, plot the thin sections throughout 1998. These will be plotted versus their relative position in the Ring starting deom the latewood/earlywood boundary of 1997 or the earlywood onset of 1998
```{r}
par(mar=c(4,4,2,2),lwd=0.5)
plot(HEL_98[,3], HEL_98[,2], type="n", ylim=c(26,34), xlim=c(0,1), axes=F, xlab = "relative position on the ring", ylab = "d18O_ on each thin section")
axis(1)
axis(2,lwd=0.5,las=2)
grid(lwd=1)
box()

lines( HEL_98[,3],HEL_98[,2], type="o",col=colb1[2],lwd=0.5, pch=1)
legend(x = 0.7, y = 34, legend = "Thin sections", col=colb1[2] , bty = "n",lwd=1,lty=1,pch = 1)

```

Calculate the average value if you would  only collect 4 sections per ring

```{r}
#Here you will need to estimate the  average of the 4 diferent quarters  based on the thin sections provided.
# example 
# sellect the sections per quarter
p25<- round(0.25*nrow(HEL_98),0)
p50<- round(0.50*nrow(HEL_98),0)
p75<- round(0.75*nrow(HEL_98),0)
p100<- round(1*nrow(HEL_98),0)

HEL_98_quarter  <- c(rep(mean(HEL_98[,2][1:p25], na.rm = T),length(1:p25)),
                  rep(mean(HEL_98[,2][(1+p25):p50], na.rm = T),length((1+p25):p50)),
                  rep(mean(HEL_98[,2][(1+p50):p75], na.rm = T),length((1+p50):p75)),
                  rep(mean(HEL_98[,2][(1+p75):p100], na.rm = T),length((1+p75):p100)))


```

Ploting  the thin section and  the average per qurters
```{r}
par(mar=c(4,4,2,2),lwd=0.5)
plot(HEL_98[,3], HEL_98[,2], type="n", ylim=c(26,34), xlim=c(0,1), axes=F, xlab = "relative position on the ring", ylab = "d18O_ on each thin section")
axis(1)
axis(2,lwd=0.5,las=2)
grid(lwd=1)
box()

lines( HEL_98[,3],HEL_98[,2], type="o",col=colb1[2],lwd=0.5, pch=1)
legend(x = 0.7, y = 34, legend = "Thin sections", col=colb1[3] , bty = "n",lwd=1)

## Add here the new plot of the average on those 4 equaly distanced sections

lines( HEL_98[,3],HEL_98_quarter, type="S",col=colb1[3],lwd=3)
legend(x = 0.7, y = 33.5, legend = "4 sections", col=colb1[3] , bty = "n",lwd=3)


```


Calculate the average value if you would  only collect one homogeneous sample form that year


```{r}
#Here you will need to estimate the  average of the ring based on the thin sections provided.
# example 
HEL_98_complete <- mean(HEL_98[,2])

```


```{r}

par(mar=c(4,4,2,2),lwd=0.5)
plot(HEL_98[,3], HEL_98[,2], type="n", ylim=c(26,34), xlim=c(0,1), axes=F, xlab = "relative position on the ring", ylab = "d18O_ on each thin section")
axis(1)
axis(2,lwd=0.5,las=2)
grid(lwd=1)
box()

lines( HEL_98[,3],HEL_98[,2], type="o",col=colb1[2],lwd=0.5, pch=1)
legend(x = 0.7, y = 34, legend = "Thin sections", col=colb1[3] , bty = "n",lwd=1)

## Add here the new plot of the average on those 4 equaly distanced sections

lines( HEL_98[,3],HEL_98_quarter, type="S",col=colb1[3],lwd=1)
legend(x = 0.7, y = 33.5, legend = "4 sections", col=colb1[3] , bty = "n",lwd=3)

abline(h = HEL_98_complete,col=colb1[1],lwd=3,lty=2)
legend(x = 0.7, y = 33, legend = "annual mean", col=colb1[1] , bty = "n",lwd=3,lty=2)
```


```{r}
# separating the EW and the LW Based on the figure we can estimate a % of EW and LW and based on this info  e can determine the sections on each anatomical region.
EW_1998 <- mean(HEL_98[,2][1:11], na.rm = T)
LW_1998 <- mean(HEL_98[,2][12:16], na.rm = T)
EW_1999 <-  mean(HEL_99[,2][1:12], na.rm = T)
LW_1999 <-  mean(HEL_99[,2][13:16], na.rm = T)

# Read the VPD form 1998 and 1999 from Heliport site Sothern Arizona.
```

```{r}

par(mar=c(4,4,2,2),lwd=0.5)
plot(HEL_98[,3], HEL_98[,2], type="n", ylim=c(26,34), xlim=c(0,1), axes=F, xlab = "relative position on the ring", ylab = "d18O_ on each thin section")
axis(1)
axis(2,lwd=0.5,las=2)
grid(lwd=1)
box()

lines( HEL_98[,3],HEL_98[,2], type="o",col=colb1[2],lwd=0.5, pch=1)
legend(x = 0.7, y = 34, legend = "Thin sections", col=colb1[3] , bty = "n",lwd=1)

## Add here the new plot of the average on those 4 equaly distanced sections

lines( HEL_98[,3],HEL_98_quarter, type="S",col=colb1[3],lwd=1)
legend(x = 0.7, y = 33.5, legend = "4 sections", col=colb1[3] , bty = "n",lwd=3)

abline(h = HEL_98_complete,col=colb1[1],lwd=1,lty=2)
legend(x = 0.7, y = 33, legend = "annual mean", col=colb1[1] , bty = "n",lwd=1,lty=2)


lines(HEL_98[,3][1:11], rep(EW_1998, 11),type="s",col="darkblue",lwd=3  )#EW
legend(x = 0.7, y = 32.5, legend = "Earlywood", col="darkblue" , bty = "n",lwd=3)

lines(HEL_98[,3][12:16], rep(LW_1998, 5),type="s",col="darkred",lwd=3  )#LW
legend(x = 0.7, y = 32, legend = "Latewood", col="darkred" , bty = "n",lwd=3)

```

Here is the VPD

```{r}
#VPD_1998
par(mar=c(4,4,2,2),lwd=0.5)
plot(x = c(1:10),y=c(1:10),xlim = c(135,304), ylim = c(0,40) , type = "n", axes = F, xlab = "DOY", ylab = "VPD")
polygon(x = days_doy, y = c(VPD_HEL[,2], rev(VPD_HEL[,3])), border = F, col = rgb(0.2,0.3,0.4,0.6))
axis(1, at = seq(135,304,15),lwd=0.5,las=2)
axis(2,at = seq(0,40, 10), las=2,lwd=0.5)
grid(lwd=1)
box()
```



## PART 2: seasonal correlations
```{r}
# here we will conduct the seasonal correlations
# using the data in this project lcated in "Data_Notebook5_part2"


```
# Read the seasonal isotopic data
```{r}
EW.c

```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
